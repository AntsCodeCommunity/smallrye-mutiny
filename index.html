<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>SmallRye Mutiny</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link href="assets/style/foundation-potion.css" media="screen" rel="stylesheet">
<link href="assets/style/style.css" media="screen" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css"/>

<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>

<script>
    $(document).ready(function () {
        console.log("ready");
        // Insert the github ribbon
        var ribbon = $("<a/>").toggleClass("github-fork-ribbon")
            .attr("href", "https://github.com/smallrye/smallrye-mutiny")
            .attr("data-ribbon", "Fork me on GitHub")
            .attr("title", "Fork me on GitHub")
            .text("Fork me on GitHub");
        $("body").prepend(ribbon);

    });
</script>


</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>SmallRye Mutiny</h1>
<div class="details">
<span id="revnumber">version 0.4.4,</span>
<span id="revdate">2020-04-06</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">SmallRye Mutiny</div>
<ul class="sectlevel2">
<li><a href="#_getting_started">1. Getting Started</a>
<ul class="sectlevel3">
<li><a href="#_prerequisites">1.1. Prerequisites</a></li>
<li><a href="#_dependencies">1.2. Dependencies</a></li>
<li><a href="#_hello_world">1.3. Hello World!</a></li>
</ul>
</li>
<li><a href="#_mutiny_philosophy_and_concepts">2. Mutiny philosophy and concepts</a>
<ul class="sectlevel3">
<li><a href="#_events">2.1. Events</a></li>
<li><a href="#_an_event_driven_api">2.2. An event-driven API</a></li>
<li><a href="#_uni_and_multi">2.3. Uni and Multi</a></li>
<li><a href="#_creating_and_subscribing_to_unis">2.4. Creating and Subscribing to Unis</a></li>
<li><a href="#_creating_and_subscribing_to_multis">2.5. Creating and Subscribing to Multis</a></li>
<li><a href="#_structuring_the_pipeline">2.6. Structuring the pipeline</a></li>
<li><a href="#_how_do_i_transform_items">2.7. How do I transform items?</a></li>
<li><a href="#_how_do_i_filterselect_items">2.8. How do I filter/select items?</a></li>
<li><a href="#_where_are_my_map_flatmap_and_concatmap_methods">2.9. Where are my map, flatMap and concatMap methods?</a></li>
<li><a href="#_how_do_i_merge_concatenate_or_combine_multis">2.10. How do I merge, concatenate or combine Multis?</a></li>
<li><a href="#_how_can_i_collect_accumulate_results">2.11. How can I collect / accumulate results?</a></li>
<li><a href="#_how_do_i_chain_asynchronous_calls">2.12. How do I chain asynchronous calls?</a></li>
<li><a href="#_how_do_i_recover_from_failure">2.13. How do I recover from failure?</a></li>
<li><a href="#_how_do_i_handle_null">2.14. How do I handle <code>null</code>?</a></li>
<li><a href="#_how_do_i_handle_timeout">2.15. How do I handle timeout?</a></li>
<li><a href="#_how_do_i_control_the_threads">2.16. How do I control the threads?</a></li>
<li><a href="#_how_do_i_interact_with_completionstages">2.17. How do I interact with CompletionStages?</a></li>
<li><a href="#_how_do_i_interact_with_rx_java_2">2.18. How do I interact with RX Java 2?</a></li>
<li><a href="#_how_do_i_interact_with_reactor">2.19. How do I interact with Reactor?</a></li>
<li><a href="#_how_do_i_control_the_back_pressure">2.20. How do I control the back-pressure?</a></li>
<li><a href="#_how_do_wrap_blocking_calls">2.21. How do wrap blocking calls?</a></li>
<li><a href="#_using_an_unicast_processor">2.22. Using an Unicast Processor</a></li>
<li><a href="#_creating_hot_streams">2.23. Creating hot streams</a></li>
<li><a href="#_how_do_i_handle_polling">2.24. How do I handle polling?</a></li>
<li><a href="#_how_do_i_handle_pagination">2.25. How do I handle pagination?</a></li>
<li><a href="#_where_do_i_find_the_javadoc">2.26. Where do I find the JavaDoc?</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<!-- toc disabled -->
<div class="paragraph">
<p>SmallRye Mutiny is a reactive programming library.
Wait? Another one? Yes!</p>
</div>
<div class="paragraph">
<p>Mutiny is designed after having experienced many issues with other Reactive programming libraries and having seen many developers lost in an endless sequence of <em>flatMap</em>.
Mutiny takes a different approach.
First, Mutiny does not provide as many operators as the other famous libraries, focusing instead on the most used operators.
Furthermore, Mutiny provides a more <em>guided</em> API, which avoids having classes with hundreds of methods that cause trouble for even the smartest IDE.
Finally, Mutiny has built-in converters from and to other reactive programing libraries, so you can always pivot.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Having questions?</div>
<div class="paragraph">
<p>You can contact the team on the <a href="https://groups.google.com/d/forum/smallrye">SmallRye Google Group</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Before digging into Mutiny, we need to understand how it relates to the other <em>reactive thingies</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/images/mutiny-in-landscape.png" alt="mutiny in landscape">
</div>
</div>
<div class="paragraph">
<p>Mutiny covers the <em>yellow</em> part of the landscape: it&#8217;s an event-driven reactive programming library, supporting (Reactive Streams) based back-pressure.
It reuses ideas from <a href="http://reactivex.io/">Reactive eXtensions</a> but does not follow the same API guidelines and operators.
Also, it can be used to build Reactive Systems, for example, by combining, Mutiny, and <a href="https://smallrye.io/smallrye-reactive-messaging/">Reactive Messaging</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_getting_started">1. Getting Started</h3>
<div class="sect3">
<h4 id="_prerequisites">1.1. Prerequisites</h4>
<div class="paragraph">
<p>Mutiny runs on top of <code>Java 8</code> and above.
Mutiny implements the <a href="https://www.reactive-streams.org/">Reactive Streams</a> specification, so depends on <code>org.reactivestreams:reactive-streams:$reactive.streams.version</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dependencies">1.2. Dependencies</h4>
<div class="paragraph">
<p>To use Mutiny, you just need the <code>io.smallrye.reactive:mutiny</code> artifact in your <code>CLASSPATH</code>.
If you are using Maven, declare the following dependency in your <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependency&gt;
    &lt;groupId&gt;io.smallrye.reactive&lt;/groupId&gt;
    &lt;artifactId&gt;mutiny&lt;/artifactId&gt;
    &lt;version&gt;0.4.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using Gradle, declare the following dependency in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">dependencies {
     implementation 'io.smallrye.reactive:mutiny:0.4.4'
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hello_world">1.3. Hello World!</h4>
<div class="paragraph">
<p>Now, you can create a class with a <code>public static void main(String&#8230;&#8203; args)</code> entry point with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import io.smallrye.mutiny.Multi;

public class GettingStarted {

    public static void main(String[] args) {
        Multi.createFrom().items("hello", "world")
                .onItem().apply(s -&gt; s.toUpperCase() + " ")
                .onCompletion().continueWith("!")
                .subscribe().with(System.out::print);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code prints <code>HELLO WORLD !</code>.
Let&#8217;s explain it a bit.
First it creates an instance of <code>Multi</code>.
A <code>Multi</code> is an object that emit <em>events</em>. In Reactive lingo, it&#8217;s a <code>Publisher</code>.
Here, this <code>Multi</code> is emitting two <em>item</em> events <code>hello</code> and <code>world</code>.
The <code>onItem</code> and <code>onCompletion</code> lines are processing respectively the <em>item</em> and <em>completion</em> events emitted by the upstream.
As a result, they also return instances of <code>Multi</code> which depending on the events received from upstream would emit events downstream.</p>
</div>
<div class="paragraph">
<p>In our example, every time the Multi emits an item, we apply a method to transform this item to uppercase, and emits the resulting value.
Then, when the upstream sends the <code>completion</code> event (no more items to emit), we produce a last item: <code>!</code> and send it downstream.
Finally, we <em>subscribe</em> to the resulting stream and for each emitted item, print it on the console.</p>
</div>
<div class="paragraph">
<p>If we represent this as a sequence diagram, we would have:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/images/diag-36a779d2e869a0312e41e21ab27aab6a.png" alt="diag 36a779d2e869a0312e41e21ab27aab6a" width="1506" height="1215">
</div>
</div>
<div class="paragraph">
<p>It&#8217;s important to understand that items and completion (and failure) flow from upstream to downstream and on the way, these events are processed.
You can visualize this as an assemble line.
The raw material is emitted from the initial source.
Each processing step takes the flowing events and process them.
Finally, at the end of the line, the finalized items are pushed to the final consumer - the subscriber.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mutiny_philosophy_and_concepts">2. Mutiny philosophy and concepts</h3>
<div class="paragraph">
<p>Mutiny is built on 3 main concepts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>event-driven - the API makes the event a first-class citizen</p>
</li>
<li>
<p>API navigability - based on the previous concept, the API is built around the type of events</p>
</li>
<li>
<p><em>single</em> or <em>multi</em> items streams - Mutiny provides 2 types: <code>Uni</code> and <code>Multi</code></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_events">2.1. Events</h4>
<div class="paragraph">
<p>When you use Mutiny you design <em>assembly lines</em> in which events flow.
Events can flow from upstream to downstream (from source to sinks), or some signals can <em>swim</em> upstream from the sinks to the source.</p>
</div>
<div class="paragraph">
<p>Events going from upstream to downstream are published by <code>Publisher</code> and consumed by <code>Subscriber</code>, which may produce events for their downstream, as illustrated by the following diagram:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/images/diag-4e60926db2b100a45f7a3fafb6d1c2c5.png" alt="diag 4e60926db2b100a45f7a3fafb6d1c2c5" width="1287" height="817">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An entity that is both a <code>Publisher</code> and a <code>Subscriber</code> is generally named a <code>Processor</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Four types of events can flow in this direction:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>subscribed - indicate that the upstream has taken into account the subscription</p>
</li>
<li>
<p>items - events containing some <em>value</em></p>
</li>
<li>
<p>completion - event indicating that no more items will be emitted</p>
</li>
<li>
<p>failure - event indicating that a failure has been encountered, and no more items will be emitted</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>failure</code> and <code>completion</code> are terminal events.
Once they are emitted, no more items are emitted.</p>
</div>
<div class="paragraph">
<p>Three types of events flow in the opposite direction, <em>i.e.</em> from downstream to upstream:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>subscription - event sent by a <em>subscriber</em> to indicate its interest for the events (such as items) emitted by upstream</p>
</li>
<li>
<p>requests - event sent by a <em>subscriber</em> indicating how many items event it is able to handle</p>
</li>
<li>
<p>cancellation - event sent by a <em>subscriber</em> to indicate no more events should be emitted</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In a typical scenario, a subscriber:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A subscriber <em>subscribes</em> to the upstream - the upstream receives the subscription <code>subscription request</code>, and when initialized sends the <code>subscribed</code> event to the subscriber</p>
</li>
<li>
<p>The subscriber receives the <code>subscribed</code> event with a <em>subscription</em> used to emit the <code>requests</code> and <code>cancellation</code> events</p>
</li>
<li>
<p>The subscriber sends a <code>request</code> event indicating how many items it can handle at the moment, it can indicate 1, <em>n</em>, or infinite.</p>
</li>
<li>
<p>The publisher receiving the <code>request</code> event start emitting at most <em>n</em> item events to the subscriber</p>
</li>
<li>
<p>The subscriber can decide at anytime to request more events, or cancel the subscription</p>
</li>
</ol>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/images/diag-c06139c2b31470fa367c3f84a6e51430.png" alt="diag c06139c2b31470fa367c3f84a6e51430" width="997" height="878">
</div>
</div>
<div class="paragraph">
<p>The <code>request</code> event is the cornerstone of the back-pressure protocol.
A subscriber should not request more than what it is able to handle, and a publisher should not emit more items than the amount of request received.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The protocol presented in this section is the Reactive Streams protocol.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If no subscriber <em>subscribes</em>, no items would be emitted. More importantly, nothing will ever happen.
If you program does not do anything, be sure you subscribed to the flow.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_an_event_driven_api">2.2. An event-driven API</h4>
<div class="paragraph">
<p>Mutiny is an event-driven API.
So for each types of event, there is an <code>on</code> associated method that let you handle this specific event.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Multi&lt;String&gt; source = Multi.createFrom().items("a", "b", "c");

source
        .onItem().invoke(item -&gt; System.out.println("Received item " + item))
        .onFailure().invoke(failure -&gt; System.out.println("Failed with " + failure.getMessage()))
        .onCompletion().invoke(() -&gt; System.out.println("Completed"))
        .on().subscribed(subscription -&gt; System.out.println("We are subscribed!"))

        .on().cancellation(() -&gt; System.out.println("Downstream has cancelled the interaction"))
        .on().request(n -&gt; System.out.println("Downstream requested " + n + " items"))
        .subscribe().with(item -&gt; {
        });</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, the methods presented in this snippet are not very interesting, although they are quite useful to trace what&#8217;s going on.
Mutiny provides many method to transform items, or the streams, compose actions&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>The API is composed by <em>groups</em>.
For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>multi.onItem()</code> provides the methods to process item events</p>
</li>
<li>
<p><code>multi.onFailure()</code> provides the methods to handle failure and recover</p>
</li>
<li>
<p><code>multi.transform()</code> provides the methods to transform the stream such as filtering or selecting items.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_uni_and_multi">2.3. Uni and Multi</h4>
<div class="paragraph">
<p>Mutiny is based on two types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Multi</code> - handle stream of <em>0..*</em> items (potentially unbounded)</p>
</li>
<li>
<p><code>Uni</code> - handle stream of <em>0..1</em> items</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both <code>Uni</code> and <code>Multi</code> are asynchronous types.
They receive and fire events, at anytime.</p>
</div>
<div class="paragraph">
<p>You may wonder why we make this distinction.
<code>Uni</code> does not need the complete ceremony presented above as the <em>request</em> does not make a lot of sense.
The <code>subscribe</code> event expresses the interest and triggers the computation.
Also, <code>Uni</code> can handle items having a <code>null</code> value (and has a specific method to handle this case).
<code>Multi</code> does not allow it (because the Reactive Streams specification forbids it).</p>
</div>
<div class="paragraph">
<p>Also, having a <code>Uni</code> implementing <code>Publisher</code> would be a bit like having <code>Optional</code> implementing <code>Iterable</code>.</p>
</div>
<div class="paragraph">
<p>In other words, <code>Uni</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>can receive at most 1 <code>item</code> event, or a <code>failure</code> event</p>
</li>
<li>
<p>cannot receive a <code>completion</code> event (<code>null</code> in the case of 0 item)</p>
</li>
<li>
<p>cannot receive a <code>request</code> event</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following snippet shows how you can use <code>Uni</code> and <code>Multi</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Multi.createFrom().items("a", "b", "c")
        .onItem().apply(i -&gt; i.toUpperCase())
        .subscribe().with(
                item -&gt; System.out.println("Received: " + item),
                failure -&gt; System.out.println("Failed with " + failure.getMessage()));

Uni.createFrom().item("a")
        .onItem().apply(i -&gt; i.toUpperCase())
        .subscribe().with(
                item -&gt; System.out.println("Received: " + item),
                failure -&gt; System.out.println("Failed with " + failure.getMessage()));</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can convert <code>Unis</code> to <code>Multis</code> and vice-versa:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Multi.createFrom().items("a", "b", "c")
        .onItem().apply(i -&gt; i.toUpperCase())
        .toUni() // Convert the multi to uni, only "a" will be forwarded.
        .subscribe().with(
                item -&gt; System.out.println("Received: " + item),
                failure -&gt; System.out.println("Failed with " + failure.getMessage()));

Uni.createFrom().item("a")
        .onItem().apply(i -&gt; i.toUpperCase())
        .toMulti() // Convert the uni to a multi, the completion event will be fired after the emission of "a"
        .subscribe().with(
                item -&gt; System.out.println("Received: " + item),
                failure -&gt; System.out.println("Failed with " + failure.getMessage()));</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_creating_and_subscribing_to_unis">2.4. Creating and Subscribing to Unis</h4>
<div class="paragraph">
<p>There are many ways to create instances of <code>Unis</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">// Creation from a known item, or computed at subscription time
Uni.createFrom().item("some known value");
Uni.createFrom().item(() -&gt; "some value computed at subscription time");

// Creation from a completion stage or completable future
Uni.createFrom().completionStage(CompletableFuture.supplyAsync(() -&gt; "result"))
        .subscribe().with(
                item -&gt; System.out.println("Received: " + item),
                failure -&gt; System.out.println("Failed with " + failure.getMessage()));

// Creation from a failure
Uni.createFrom().failure(() -&gt; new Exception("exception created at subscription time"));

// Creation from an emitter
Uni.createFrom().emitter(emitter -&gt; {
    // ...
    emitter.complete("some result");
    //...
});

// Create from a Reactive Streams Publisher or a Multi
Uni.createFrom().publisher(Multi.createFrom().ticks().every(Duration.ofMillis(1)))
        .subscribe().with(
                item -&gt; System.out.println("Received tick " + item),
                failure -&gt; System.out.println("Failed with " + failure.getMessage()));

// Defer the creation of the uni until subscription time
Uni.createFrom().deferred(() -&gt; Uni.createFrom().item("create the uni at subscription time"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Subscribing to <code>Unis</code> is done by method provided by <code>uni.subscribe()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Uni&lt;String&gt; uni = Uni.createFrom().item("hello");

// Passing callbacks
Cancellable cancellable = uni.subscribe().with(
        item -&gt; System.out.println("Got item: " + item),
        failure -&gt; System.out.println("Got a failure " + failure.getMessage()));
// You can use the returned `cancellation` to cancel the computation.
cancellable.cancel();

uni.subscribe().withSubscriber(new UniSubscriber&lt;String&gt;() {
    @Override
    public void onSubscribe(UniSubscription subscription) {
        System.out.println("Got the subscription: " + subscription);
    }

    @Override
    public void onItem(String item) {
        System.out.println("Got the item: " + item);
    }

    @Override
    public void onFailure(Throwable failure) {
        System.out.println("Got the failure: " + failure);
    }
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_creating_and_subscribing_to_multis">2.5. Creating and Subscribing to Multis</h4>
<div class="paragraph">
<p>There are many ways to create instances of <code>Multis</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">// Creation from a known item(s), or computed at subscription time
Multi.createFrom().item("some known value");
Multi.createFrom().item(() -&gt; "some value computed at subscription time");
Multi.createFrom().items("a", "b", "c");
Multi.createFrom().items(() -&gt; Stream.of("computed", "at", "subscription", "time"));
Multi.createFrom().iterable(Arrays.asList("some", "produceIterable"));

// Creation from a completion stage or completable future
Multi.createFrom().completionStage(CompletableFuture.supplyAsync(() -&gt; "result"))
        .subscribe().with(
                item -&gt; System.out.println("Received: " + item),
                failure -&gt; System.out.println("Failed with " + failure.getMessage()));

// Creation from a failure
Multi.createFrom().failure(() -&gt; new Exception("exception created at subscription time"));

// Creation from an emitter
Multi.createFrom().emitter(emitter -&gt; {
    // ...
    emitter.emit("a");
    emitter.emit("b");
    emitter.complete();
    //...
});

// Create from a Reactive Streams Publisher or a Multi
Multi.createFrom().publisher(Multi.createFrom().ticks().every(Duration.ofMillis(1)))
        .transform().byTakingFirstItems(2)
        .subscribe().with(
                item -&gt; System.out.println("Received tick " + item),
                failure -&gt; System.out.println("Failed with " + failure.getMessage()));

// Defer the creation of the uni until subscription time
Multi.createFrom().deferred(() -&gt; Multi.createFrom().item("create the uni at subscription time"));

// Created from a Uni
Multi.createFrom().uni(Uni.createFrom().item("hello"));

// Created from periodic ticks
Multi.createFrom().ticks().every(Duration.ofMillis(1))
        .transform().byTakingFirstItems(2);

// Created from integer range
Multi.createFrom().range(1, 11);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Subscribing to <code>Multis</code> is done by method provided by <code>multi.subscribe()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Multi&lt;String&gt; multi = Multi.createFrom().items("a", "b", "c");

Cancellable cancellable = multi.subscribe().with(
        item -&gt; System.out.println("Got " + item));
// you can use the returned Cancellable to cancel the computation
cancellable.cancel();

cancellable = multi.subscribe().with(
        item -&gt; System.out.println("Got " + item),
        failure -&gt; System.out.println("Got a failure: " + failure),
        () -&gt; System.out.println("Got the completion event"));

multi.subscribe().withSubscriber(new MultiSubscriber&lt;String&gt;() {
    @Override
    public void onSubscribe(Subscription s) {
        System.out.println("Got subscription: " + s);
    }

    @Override
    public void onItem(String item) {
        System.out.println("Got an item: " + item);
    }

    @Override
    public void onFailure(Throwable failure) {
        System.out.println("Got a failure: " + failure);
    }

    @Override
    public void onCompletion() {
        System.out.println("Got the completion event");
    }
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_structuring_the_pipeline">2.6. Structuring the pipeline</h4>
<div class="paragraph">
<p>It can be hard to structure your sequence of processing in a readable manner.
Mutiny provides the <code>then</code> function to structure your pipeline:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">String result = Multi.createFrom().completionStage(CompletableFuture.supplyAsync(() -&gt; 23))
        .then(self -&gt; {
            // Transform each item into a string of the item +1
            return self
                    .onItem().apply(i -&gt; i + 1)
                    .onItem().apply(i -&gt; Integer.toString(i));
        })
        .then(self -&gt; self
                .onItem().invoke(item -&gt; System.out.println("The item is " + item))
                .collectItems().first())
        .then(self -&gt; self.await().indefinitely());</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>then</code> can be used on <code>Multi</code> and <code>Uni</code> and let you group a set of operations in a logical set.
== How Do I do x?</p>
</div>
</div>
<div class="sect3">
<h4 id="_how_do_i_transform_items">2.7. How do I transform items?</h4>
<div class="paragraph">
<p>To transform items synchronously use the <code>apply</code> operators:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">String result1 = uni
        .onItem().apply(s -&gt; s.toUpperCase())
        .await().indefinitely();
List&lt;String&gt; result2 = multi
        .onItem().apply(s -&gt; s.toUpperCase())
        .collectItems().asList().await().indefinitely();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also transform items asynchronously using the <code>produceUni</code> / <code>produceCompletionStage</code> operators:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">String result1 = uni
        .onItem().produceUni(s -&gt; Uni.createFrom().item(s.toUpperCase()))
        .await().indefinitely();
String result2 = uni
        .onItem().produceCompletionStage(s -&gt; CompletableFuture.supplyAsync(() -&gt; s.toUpperCase()))
        .await().indefinitely();
List&lt;String&gt; result3 = multi
        .onItem().produceUni(s -&gt; Uni.createFrom().item(s.toUpperCase())).concatenate()
        .collectItems().asList().await().indefinitely();
List&lt;String&gt; result4 = multi
        .onItem().produceCompletionStage(s -&gt; CompletableFuture.supplyAsync(() -&gt; s.toUpperCase()))
        .concatenate()
        .collectItems().asList().await().indefinitely();</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need to generate a sequence of items use, <code>producePublisher</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">List&lt;String&gt; result = multi
        .onItem().producePublisher(s -&gt; Multi.createFrom().item(s.toUpperCase())).concatenate()
        .collectItems().asList().await().indefinitely();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_how_do_i_filterselect_items">2.8. How do I filter/select items?</h4>
<div class="paragraph">
<p>On <code>Multi</code>, you may need to filter / select items.
To achieve this, there is a set of methods available in <code>multi.transform()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">List&lt;Integer&gt; list = multi
        .transform().byFilteringItemsWith(i -&gt; i &gt; 6)
        .collectItems().asList()
        .await().indefinitely();

List&lt;Integer&gt; list2 = multi
        .transform().byTestingItemsWith(i -&gt; Uni.createFrom().item(i &gt; 6))
        .collectItems().asList()
        .await().indefinitely();

List&lt;Integer&gt; list = multi
        .transform().byTakingFirstItems(2)
        .collectItems().asList()
        .await().indefinitely();

List&lt;Integer&gt; list2 = multi
        .transform().byTakingItemsWhile(i -&gt; i &lt; 3)
        .collectItems().asList()
        .await().indefinitely();

List&lt;Integer&gt; list3 = multi
        .transform().byTakingLastItems(2)
        .collectItems().asList()
        .await().indefinitely();

List&lt;Integer&gt; list = multi
        .transform().bySkippingFirstItems(8)
        .collectItems().asList()
        .await().indefinitely();

List&lt;Integer&gt; list2 = multi
        .transform().bySkippingItemsWhile(i -&gt; i &lt; 9)
        .collectItems().asList()
        .await().indefinitely();

List&lt;Integer&gt; list3 = multi
        .transform().bySkippingLastItems(8)
        .collectItems().asList()
        .await().indefinitely();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also drop distinct items or drop repetitions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">List&lt;Integer&gt; list = multi
        .transform().byDroppingDuplicates()
        .collectItems().asList()
        .await().indefinitely();

List&lt;Integer&gt; list2 = multi
        .transform().byDroppingRepetitions()
        .collectItems().asList()
        .await().indefinitely();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_where_are_my_map_flatmap_and_concatmap_methods">2.9. Where are my map, flatMap and concatMap methods?</h4>
<div class="paragraph">
<p>If you are a seasoned reactive developer, you may miss the infamous <code>map</code>, <code>flatMap</code>, <code>concatMap</code> methods.
Mutiny also proposes there methods using the most-used variants of them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">int result = uni
        .map(i -&gt; i + 1)
        .await().indefinitely();

int result2 = uni
        .flatMap(i -&gt; Uni.createFrom().item(i + 1))
        .await().indefinitely();

List&lt;Integer&gt; list = multi
        .map(i -&gt; i + 1)
        .collectItems().asList()
        .await().indefinitely();

List&lt;Integer&gt; list2 = multi
        .flatMap(i -&gt; Multi.createFrom().items(i, i))
        .collectItems().asList()
        .await().indefinitely();

List&lt;Integer&gt; list3 = multi
        .concatMap(i -&gt; Multi.createFrom().items(i, i))
        .collectItems().asList()
        .await().indefinitely();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mutiny API is quite different from the <em>traditional</em> reactive eXtensions API.
The equivalent to <code>map</code>, <code>flatMap</code> and <code>concatMap</code> are the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">int result = uni
        .onItem().apply(i -&gt; i + 1)
        .await().indefinitely();

int result2 = uni
        .onItem().produceUni(i -&gt; Uni.createFrom().item(i + 1))
        .await().indefinitely();

List&lt;Integer&gt; list = multi
        .onItem().apply(i -&gt; i + 1)
        .collectItems().asList()
        .await().indefinitely();

List&lt;Integer&gt; list2 = multi
        .onItem().produceMulti(i -&gt; Multi.createFrom().items(i, i)).merge()
        .collectItems().asList()
        .await().indefinitely();

List&lt;Integer&gt; list3 = multi
        .onItem().produceMulti(i -&gt; Multi.createFrom().items(i, i)).concatenate()
        .collectItems().asList()
        .await().indefinitely();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_how_do_i_merge_concatenate_or_combine_multis">2.10. How do I merge, concatenate or combine Multis?</h4>
<div class="paragraph">
<p>You can create instances of <code>Multi</code> by concatenating, merging, or combining <code>Multi</code>s and <code>Publisher</code>s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">List&lt;Integer&gt; list1 = Multi.createBy().merging().streams(multi1, multi2, multi3)
        .collectItems().asList()
        .await().indefinitely();

List&lt;Integer&gt; list2 = Multi.createBy().concatenating().streams(multi1, multi2, multi3)
        .collectItems().asList()
        .await().indefinitely();

List&lt;Integer&gt; list3 = Multi.createBy()
        .combining().streams(multi1, multi2, multi3).using((a, b, c) -&gt; a + b + c)
        .collectItems().asList()
        .await().indefinitely();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_how_can_i_collect_accumulate_results">2.11. How can I collect / accumulate results?</h4>
<div class="paragraph">
<p>You can collect the items from a <code>Multi</code> using the method proposed by <code>collectItems()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">// collectItems let you collect items into a Uni of data structure.
// The final result is emitted when the completion event is received
Uni&lt;List&lt;Integer&gt;&gt; list = multi.collectItems().asList();
Uni&lt;Map&lt;String, Integer&gt;&gt; map = multi.collectItems().asMap(i -&gt; Integer.toString(i));

// You can retrieve the first and last items
Uni&lt;Integer&gt; first = multi.collectItems().first();
Uni&lt;Integer&gt; last = multi.collectItems().last();

// you can also get a **blocking** iterable / streams
BlockingIterable&lt;Integer&gt; integers = multi.subscribe().asIterable();
Stream&lt;Integer&gt; stream = multi.subscribe().asStream();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also accumulate results using the <code>scan</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Multi&lt;Integer&gt; added = multi.onItem().scan(() -&gt; 0, (item, acc) -&gt; acc + item);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_how_do_i_chain_asynchronous_calls">2.12. How do I chain asynchronous calls?</h4>
<div class="paragraph">
<p>To chain asynchronous calls, use <code>onItem().produceUni</code> or <code>onItem().produceCompletionStage</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">CompletableFuture&lt;String&gt; future = uni
        .onItem().produceUni(this::asyncOperation)
        .onItem().produceUni(this::anotherAsyncOperation)
        .subscribeAsCompletionStage();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_how_do_i_recover_from_failure">2.13. How do I recover from failure?</h4>
<div class="paragraph">
<p>Failures are inherent to software.
So you need to handle them.
By default, they flow in the stream until they reach the final subscriber.
But at any stage you can process the failure and transform or recover from it.</p>
</div>
<div class="paragraph">
<p>The following snippet shows how you can recover from a failure on a <code>Uni</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">// Transform a failure in another type of failure
CompletableFuture&lt;String&gt; res0 = uni.onFailure().apply(failure -&gt; new MyBusinessException("oh no!"))
        .subscribeAsCompletionStage();

// Recover with an item
String res1 = uni
        .onFailure().recoverWithItem("hello")
        .await().indefinitely();

// Filter the type of failure
String res2 = uni
        .onFailure(IllegalArgumentException.class).recoverWithItem("bonjour")
        .onFailure(IOException.class).recoverWithItem("hello")
        .await().indefinitely();

// Recover recover with an uni
String res3 = uni
        .onFailure().recoverWithUni(() -&gt; Uni.createFrom().item("fallback"))
        .await().indefinitely();

// Retry at most twice
CompletableFuture&lt;String&gt; res4 = uni
        .onFailure().retry().atMost(2)
        .subscribeAsCompletionStage();</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Multi</code>s have the same API letting you recover from failure easily:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">CompletableFuture&lt;String&gt; res0 = multi.onFailure().apply(failure -&gt; new MyBusinessException("oh no!"))
        .collectItems().first()
        .subscribeAsCompletionStage();

String res1 = multi
        .onFailure().recoverWithItem("hello")
        .collectItems().first()
        .await().indefinitely();

String res2 = multi
        .onFailure(IllegalArgumentException.class).recoverWithItem("bonjour")
        .onFailure(IOException.class).recoverWithItem("hello")
        .collectItems().first()
        .await().indefinitely();

String res3 = multi
        .onFailure().recoverWithMulti(() -&gt; Multi.createFrom().items("a", "b", "c"))
        .collectItems().first()
        .await().indefinitely();

CompletableFuture&lt;String&gt; res4 = multi
        .onFailure().retry().atMost(2)
        .collectItems().first()
        .subscribeAsCompletionStage();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that with <code>Multi</code>, a failure cancels the subscription, meaning you will not receive any more items.</p>
</div>
<div class="paragraph">
<p>The <code>retry</code> operator lets you re-subscribe and continue the reception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_how_do_i_handle_null">2.14. How do I handle <code>null</code>?</h4>
<div class="paragraph">
<p><code>null</code> is only accepted in the <code>Uni</code> type.
<code>uni.onItem().ifNull()</code> lets you decide what you want to do when the received item is <code>null</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">uni.onItem().ifNull().continueWith("hello");
uni.onItem().ifNull().switchTo(() -&gt; Uni.createFrom().item("hello"));
uni.onItem().ifNull().failWith(() -&gt; new Exception("Boom!"));</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_how_do_i_handle_timeout">2.15. How do I handle timeout?</h4>
<div class="paragraph">
<p><code>Uni</code> are often used to represent asynchronous operations, like an HTTP call.
So, it&#8217;s not rare to need to add a timeout on this kind of operation, and recover if the timeout occurs.</p>
</div>
<div class="paragraph">
<p>This can be done using <code>Uni.ifNoItem()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">String item = uni
        .ifNoItem().after(Duration.ofMillis(100)).recoverWithItem("some fallback item")
        .await().indefinitely();</code></pre>
</div>
</div>
<div class="paragraph">
<p>On timeout, you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>fail</p>
</li>
<li>
<p>recover with a specific item</p>
</li>
<li>
<p>continue with another alternative <code>Uni</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_how_do_i_control_the_threads">2.16. How do I control the threads?</h4>
<div class="paragraph">
<p>Except indicated otherwise, the next processor is invoked on the thread emitting the event from upstream.
You can switch to another thread using the <code>emitOn</code> operator.
The <code>emitOn</code> operator lets you switch the thread used to dispatch (upstream to downstream) events, so items, failure and completion.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">String res0 = uni.emitOn(executor)
        .onItem()
        .invoke(s -&gt; System.out.println("Received item `" + s + "` on thread: " + Thread.currentThread().getName()))
        .await().indefinitely();

String res1 = multi.emitOn(executor)
        .onItem()
        .invoke(s -&gt; System.out.println("Received item `" + s + "` on thread: " + Thread.currentThread().getName()))
        .collectItems().first()
        .await().indefinitely();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_how_do_i_interact_with_completionstages">2.17. How do I interact with CompletionStages?</h4>
<div class="paragraph">
<p><code>CompletionStage</code> and <code>CompletableFuture</code> are classes provided by Java to represent asynchronous actions.
However, they are not lazy, and do not follow a <em>subscription</em> patterns.</p>
</div>
<div class="paragraph">
<p>Mutiny lets you create <code>Uni</code> and <code>Multi</code> from instances of these classes.
Also, <code>Uni</code> offers a way to retrieve the item or the failure as a <code>CompletableFuture</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">CompletableFuture&lt;String&gt; future1 = Uni
        // Create from a Completion Stage
        .createFrom().completionStage(CompletableFuture.supplyAsync(() -&gt; "hello"))
        .map(String::toUpperCase)
        .subscribeAsCompletionStage(); // Retrieve as a Completion Stage

CompletableFuture&lt;List&lt;String&gt;&gt; future2 = Multi
        .createFrom().completionStage(CompletableFuture.supplyAsync(() -&gt; "hello"))
        .map(String::toUpperCase)
        .collectItems().asList() // Accumulate items in a list (return a Uni&lt;List&lt;T&gt;&gt;)
        .subscribeAsCompletionStage();// Retrieve the list as a Completion Stage</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_how_do_i_interact_with_rx_java_2">2.18. How do I interact with RX Java 2?</h4>
<div class="paragraph">
<p>Mutiny allows converting Rx Java 2 types to/from Uni and Multi instances.
To enable this feature, add the following dependency to your <code>CLASSPATH</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependency&gt;
    &lt;groupId&gt;io.smallrye.reactive&lt;/groupId&gt;
    &lt;artifactId&gt;mutiny-rxjava&lt;/artifactId&gt;
    &lt;version&gt;0.4.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, you would need to import:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import io.smallrye.mutiny.converters.multi.MultiRxConverters;
import io.smallrye.mutiny.converters.uni.UniRxConverters;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create a <code>Uni</code> from RxJava 2 objects, use the following methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Completable completable = Completable.complete();
Single&lt;String&gt; single = Single.just("hello");
Maybe&lt;String&gt; maybe = Maybe.just("hello");
Maybe&lt;String&gt; emptyMaybe = Maybe.empty();
Observable&lt;String&gt; observable = Observable.fromArray("a", "b", "c");
Flowable&lt;String&gt; flowable = Flowable.fromArray("a", "b", "c");

Uni&lt;Void&gt; uniFromCompletable = Uni.createFrom().converter(UniRxConverters.fromCompletable(), completable);
Uni&lt;String&gt; uniFromSingle = Uni.createFrom().converter(UniRxConverters.fromSingle(), single);
Uni&lt;String&gt; uniFromMaybe = Uni.createFrom().converter(UniRxConverters.fromMaybe(), maybe);
Uni&lt;String&gt; uniFromEmptyMaybe = Uni.createFrom().converter(UniRxConverters.fromMaybe(), emptyMaybe);
Uni&lt;String&gt; uniFromObservable = Uni.createFrom().converter(UniRxConverters.fromObservable(), observable);
Uni&lt;String&gt; uniFromFlowable = Uni.createFrom().converter(UniRxConverters.fromFlowable(), flowable);
Uni&lt;String&gt; uniFromPublisher = Uni.createFrom().publisher(flowable);</code></pre>
</div>
</div>
<div class="paragraph">
<p>When converting a <code>Completable</code> or an empty <code>Maybe</code> to a <code>Uni</code>, the <code>Uni</code> receives a <code>null</code> item.
Use <code>onItem().ifNull()</code> to handle this case.</p>
</div>
<div class="paragraph">
<p>Note that, when converting an <code>Observable</code> or a <code>Flowable</code> to a <code>Uni</code>, only the first element is requested.
Once received, the underlying subscription is cancelled.</p>
</div>
<div class="paragraph">
<p>Also note that you can create a <code>Uni</code> from a Reactive Streams <code>Publisher</code> using <code>Uni.createFrom().publisher(&#8230;&#8203;)</code>.</p>
</div>
<div class="paragraph">
<p>To create Rx Java 2 types from a <code>Uni</code>, use the following methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Completable completable = uni.convert().with(UniRxConverters.toCompletable());
Single&lt;Optional&lt;String&gt;&gt; single = uni.convert().with(UniRxConverters.toSingle());
Single&lt;String&gt; single2 = uni.convert().with(UniRxConverters.toSingle().failOnNull());
Maybe&lt;String&gt; maybe = uni.convert().with(UniRxConverters.toMaybe());
Observable&lt;String&gt; observable = uni.convert().with(UniRxConverters.toObservable());
Flowable&lt;String&gt; flowable = uni.convert().with(UniRxConverters.toFlowable());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because <code>Uni</code> can emit <code>null</code>, the default converter produces a <code>Single&lt;Optional&lt;T&gt;&gt;</code>.
You can retrieve a <code>Single&lt;T&gt;</code> and fail instead using <code>toSingle().failOnNull()</code>.</p>
</div>
<div class="paragraph">
<p>To create a <code>Multi</code> from RxJava 2 objects, use the following methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Completable completable = Completable.complete();
Single&lt;String&gt; single = Single.just("hello");
Maybe&lt;String&gt; maybe = Maybe.just("hello");
Maybe&lt;String&gt; emptyMaybe = Maybe.empty();
Observable&lt;String&gt; observable = Observable.fromArray("a", "b", "c");
Flowable&lt;String&gt; flowable = Flowable.fromArray("a", "b", "c");

Multi&lt;Void&gt; multiFromCompletable = Multi.createFrom()
        .converter(MultiRxConverters.fromCompletable(), completable);
Multi&lt;String&gt; multiFromSingle = Multi.createFrom().converter(MultiRxConverters.fromSingle(), single);
Multi&lt;String&gt; multiFromMaybe = Multi.createFrom().converter(MultiRxConverters.fromMaybe(), maybe);
Multi&lt;String&gt; multiFromEmptyMaybe = Multi.createFrom().converter(MultiRxConverters.fromMaybe(), emptyMaybe);
Multi&lt;String&gt; multiFromObservable = Multi.createFrom()
        .converter(MultiRxConverters.fromObservable(), observable);
Multi&lt;String&gt; multiFromFlowable = Multi.createFrom().converter(MultiRxConverters.fromFlowable(), flowable);
Multi&lt;String&gt; multiFromPublisher = Multi.createFrom().publisher(flowable);</code></pre>
</div>
</div>
<div class="paragraph">
<p>As for <code>Uni</code>, you can create a <code>Multi</code> from a Reactive Streams <code>Publisher</code> using <code>Multi.createFrom().publisher(&#8230;&#8203;)</code>.</p>
</div>
<div class="paragraph">
<p>You can also create RxJava 2 objects from a <code>Multi</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Completable completable = multi.convert().with(MultiRxConverters.toCompletable());
Single&lt;Optional&lt;String&gt;&gt; single = multi.convert().with(MultiRxConverters.toSingle());
Single&lt;String&gt; single2 = multi.convert().with(MultiRxConverters
        .toSingle().onEmptyThrow(() -&gt; new Exception("D'oh!")));
Maybe&lt;String&gt; maybe = multi.convert().with(MultiRxConverters.toMaybe());
Observable&lt;String&gt; observable = multi.convert().with(MultiRxConverters.toObservable());
Flowable&lt;String&gt; flowable = multi.convert().with(MultiRxConverters.toFlowable());</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_how_do_i_interact_with_reactor">2.19. How do I interact with Reactor?</h4>
<div class="paragraph">
<p>Mutiny allows converting Project Reactor types to/from <code>Uni</code> and <code>Multi</code> instances.
To enable this feature, add the following dependency to your <code>CLASSPATH</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependency&gt;
    &lt;groupId&gt;io.smallrye.reactive&lt;/groupId&gt;
    &lt;artifactId&gt;mutiny-reactor&lt;/artifactId&gt;
    &lt;version&gt;0.4.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, you would need to import:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import io.smallrye.mutiny.converters.multi.MultiReactorConverters;
import io.smallrye.mutiny.converters.uni.UniReactorConverters;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create a <code>Uni</code> from Reactor objects, use the following methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Mono&lt;Void&gt; empty = Mono.empty();
Mono&lt;String&gt; mono = Mono.just("hello");
Flux&lt;String&gt; flux = Flux.just("a", "b", "c");

Uni&lt;Void&gt; uniFromEmptyMono = Uni.createFrom().converter(UniReactorConverters.fromMono(), empty);
Uni&lt;String&gt; uniFromMono = Uni.createFrom().converter(UniReactorConverters.fromMono(), mono);
Uni&lt;String&gt; uniFromFlux = Uni.createFrom().converter(UniReactorConverters.fromFlux(), flux);
Uni&lt;String&gt; uniFromPublisher = Uni.createFrom().publisher(flux);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create Reactor <code>Flux</code> and <code>Mono</code> instances from a <code>Uni</code>, use the following methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Mono&lt;String&gt; mono = uni.convert().with(UniReactorConverters.toMono());
Flux&lt;String&gt; flux = uni.convert().with(UniReactorConverters.toFlux());</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create a <code>Multi</code> from Reactor objects, use the following methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Mono&lt;Void&gt; empty = Mono.empty();
Mono&lt;String&gt; mono = Mono.just("hello");
Flux&lt;String&gt; flux = Flux.just("a", "b", "c");

Multi&lt;Void&gt; multiFromEmptyMono = Multi.createFrom()
        .converter(MultiReactorConverters.fromMono(), empty);
Multi&lt;String&gt; multiFromMono = Multi.createFrom().converter(MultiReactorConverters.fromMono(), mono);
Multi&lt;String&gt; multiFromFlux = Multi.createFrom().converter(MultiReactorConverters.fromFlux(), flux);
Multi&lt;String&gt; multiFromPublisher = Multi.createFrom().publisher(flux);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also create Reactor objects from a <code>Multi</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Mono&lt;String&gt; mono = multi.convert().with(MultiReactorConverters.toMono());
Flux&lt;String&gt; flux = multi.convert().with(MultiReactorConverters.toFlux());</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_how_do_i_control_the_back_pressure">2.20. How do I control the back-pressure?</h4>
<div class="paragraph">
<p>When a consumer cannot keep up with the pace of a publisher, there is an overflow condition.
By default, it would fail and propagate an exception.</p>
</div>
<div class="paragraph">
<p>However, you can control how the overflow is handled using the <code>multi.onOverflow()</code> method, such as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">String res1 = multi
        .emitOn(executor)
        .onOverflow().buffer(10)
        .collectItems().first()
        .await().indefinitely();

String res2 = multi
        .emitOn(executor)
        .onOverflow().dropPreviousItems()
        .collectItems().first()
        .await().indefinitely();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_how_do_wrap_blocking_calls">2.21. How do wrap blocking calls?</h4>
<div class="paragraph">
<p>It is often the case that a source of data (web service, database&#8230;&#8203;) is synchronous and blocking.
To deal with such sources in your applications, apply the following pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Uni&lt;String&gt; blocking = Uni.createFrom().item(this::invokeRemoteServiceUsingBlockingIO)
        .subscribeOn(Infrastructure.getDefaultWorkerPool());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create an <code>Uni</code> that will supply the item using a blocking call, here the <code>invokeRemoteServiceUsingBlockingIO</code> method.
To avoid blocking the subscriber, use <code>subscribeOn</code> which switch the thread and so call <code>invokeRemoteServiceUsingBlockingIO</code> on another thread.
Here we pass the default worker thread pool, but you can use your own executor.</p>
</div>
<div class="paragraph">
<p>Note that <code>subscribeOn</code> does not subscribe to the <code>Uni</code>.
It specifies the <code>executor</code> to use when a subscribe call happens.</p>
</div>
<div class="paragraph">
<p>Using <code>subscribeOn</code> works when the blocking operation happens at subscription time.
But, when you are dealing with <code>Multi</code> and need to execute a blocking operation for each item, you need <code>emitOn</code>.</p>
</div>
<div class="paragraph">
<p>While <code>subscribeOn</code> runs the subscription on the given executor, <code>emitOn</code> configures the executor used to propagate downstream the <code>item</code>, <code>failure</code> and <code>completion</code> events:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Multi&lt;String&gt; multi = Multi.createFrom().items("john", "jack", "sue")
        .emitOn(Infrastructure.getDefaultWorkerPool())
        .onItem().apply(this::invokeRemoteServiceUsingBlockingIO);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_an_unicast_processor">2.22. Using an Unicast Processor</h4>
<div class="paragraph">
<p>The <code>UnicastProcessor</code> is an implementation of <code>Multi</code> that lets you enqueue items in a queue.
The items are then dispatched to the subscriber using the request protocol.
While this pattern is against the idea of back-pressure, it lets you connect sources of data that do not support back-pressure with your subscriber.</p>
</div>
<div class="paragraph">
<p>In the following example, the <code>UnicastProcessor</code> is used by a thread emitting items.
These items are enqueued in the processor and replayed when the subscriber is connected, following the request protocol.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">UnicastProcessor&lt;String&gt; processor = UnicastProcessor.create();
Multi&lt;String&gt; multi = processor
        .onItem().apply(String::toUpperCase)
        .onFailure().recoverWithItem("d'oh");

// Create a source of items that does not follow the request protocol
new Thread(() -&gt; {
    for (int i = 0; i &lt; 1000; i++) {
        processor.onNext(Integer.toString(i));
    }
    processor.onComplete();
}).start();</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default the <code>UnicastProcessor</code> uses an unbounded queue.
You can also pass a fixed size queue that would reject the items once full.</p>
</div>
</div>
<div class="sect3">
<h4 id="_creating_hot_streams">2.23. Creating hot streams</h4>
<div class="paragraph">
<p>In a <em>cold</em> stream, the stream is created when one subscriber subscribes to the stream.
So, if no one subscribes, the actual stream is not created, saving resources (that would be wasted because nobody is interested in the items).</p>
</div>
<div class="paragraph">
<p>In a <em>hot</em> stream, the stream exists before subscribers subscribe.
The stream emits items even if no subscribers observe the stream.
If there are no subscribers, the items are just dropped.
Subscribers only get items emitted after their subscription, meaning that any previous items would not be received.</p>
</div>
<div class="paragraph">
<p>To create a hot stream, you can use <code>io.smallrye.mutiny.operators.multi.processors.BroadcastProcessor</code> that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>drops items if no subscribers are present</p>
</li>
<li>
<p>forwards items to the set of observing subscribers</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">BroadcastProcessor&lt;String&gt; processor = BroadcastProcessor.create();
Multi&lt;String&gt; multi = processor
        .onItem().apply(String::toUpperCase)
        .onFailure().recoverWithItem("d'oh");

new Thread(() -&gt; {
    for (int i = 0; i &lt; 1000; i++) {
        processor.onNext(Integer.toString(i));
    }
    processor.onComplete();
}).start();

// Subscribers can subscribe at any time.
// They will only receive items emitted after their subscription.
// If the source is already terminated (by a completion or a failure signal)
// the subscriber receives this signal.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>BroadcastProcessor</code> subscribes to the <em>hot</em> source aggressively and without back-pressure.
However, the <code>BroadcastProcessor</code> enforces the back-pressure protocol per subscriber.
If a subscriber is not ready to handle an item emitted by the <em>hot</em> source, an <code>io.smallrye.mutiny.subscription.BackPressureFailure</code> is forwarded to this subscriber.</p>
</div>
</div>
<div class="sect3">
<h4 id="_how_do_i_handle_polling">2.24. How do I handle polling?</h4>
<div class="paragraph">
<p>There are many poll-based API around us.
Sometimes you need to use these APIs to generate a stream from the polled values.
To do this, use the <code>repeat()</code> feature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">PollableDataSource source = new PollableDataSource();
// First creates a uni that emit the polled item. Because `poll` blocks, let's use a specific executor
Uni&lt;String&gt; pollItemFromSource = Uni.createFrom().item(source::poll).subscribeOn(executor);
// To get the stream of items, just repeat the uni indefinitely
Multi&lt;String&gt; stream = pollItemFromSource.repeat().indefinitely();

Cancellable cancellable = stream.subscribe().with(item -&gt; System.out.println("Polled item: " + item));
// ... later ..
// when you don't want the items anymore, cancel the subscription and close the source if needed.
cancellable.cancel();
source.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also stop the repetition using the <code>repeat().until()</code> method which will continue the repetition until the given predicate returns <code>true</code>, and/or directly create a <code>Multi</code> using <code>Multi.createBy().repeating()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">PollableDataSource source = new PollableDataSource();
Multi&lt;String&gt; stream = Multi.createBy().repeating()
            .supplier(source::poll)
            .until(s -&gt; s == null)
        .subscribeOn(executor);

stream.subscribe().with(item -&gt; System.out.println("Polled item: " + item));</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_how_do_i_handle_pagination">2.25. How do I handle pagination?</h4>
<div class="paragraph">
<p>There are many REST / HTTP API using pagination, <em>i.e.</em> return only a subset of the results and you need to request the next page to get the next batch.
Each batch contains a list of item(s).
To use this kind of API and generate a continuous stream of items, you need to use the <code>Multi.createBy().repeating()</code> function.
However, we need to pass a cursor / state to advance and avoid requesting again and again the same page.
Fortunately, <code>repeating</code> provides methods to pass a shared state.
So by combining these methods and <code>disjoint</code> you can generate streams from these pages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">PaginatedApi api = new PaginatedApi();

Multi&lt;String&gt; stream = Multi.createBy().repeating()
        .completionStage(
                () -&gt; new AtomicInteger(),
                state -&gt; api.getPage(state.getAndIncrement()))
        .until(list -&gt; list.isEmpty())
        .onItem().disjoint();</code></pre>
</div>
</div>
<div class="paragraph">
<p>First, you create a <code>Multi</code> containing the items emitted by the <code>CompletionStage</code> supplier and pass a state supplier to progress among the pages.</p>
</div>
<div class="paragraph">
<p>Then, use <code>until</code> to call the paginated API until we have all the items.
At the point we have a stream of list of item such as <code>["a", "b", "c"], ["d", "e"], []</code>.
However we want the following stream: <code>"a", "b", "c", "d", "e"</code>.
The <code>disjoint</code> method does exactly this.
It gets the items from the lists and passes them downstream:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/images/diag-1cddf88909ef82bdaa96ca9da9f4c028.png" alt="diag 1cddf88909ef82bdaa96ca9da9f4c028" width="652" height="628">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_where_do_i_find_the_javadoc">2.26. Where do I find the JavaDoc?</h4>
<div class="paragraph">
<p>The JavaDoc is published <a href="https://smallrye.io/smallrye-mutiny/apidocs/">there</a>.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.4.4<br>
Last updated 2020-04-06 16:17:31 UTC
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>